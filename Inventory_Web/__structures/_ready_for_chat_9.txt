شرح پروژه :
پروژه انبار با امنیت زیاد و به صورت جامع بنویسم که در آینده بتونم برای آن سیستم خرید و مالی هم طراحی و به آن اضافه کنم.
محیط کار : ویندوز 10 – محیط برنامه نویسی visual studio 2019 – asp.net core 5
این برنامه شامل دو پروژه است : قسمت API و قسمت WEB
1. 	ذخیره اطلاعات کالاها با توجه به مواردی مثل نام کالا، نام 2، کد اصلی کالا، کد 2، کد3، تعداد موجودی کالا، نقطه سفارش، موجودی اطمینان
2.	با توجه به اینکه هر کالا ممکن است توسط چند برند تولید شود و ذخیره این برندها اهمیت دارد. باید راهکاری برای گزارشگیری اینکه در هر لحظه از هر برند چه تعداد از آن کالا موجود می باشد هم ایجاد شود.
3.	با توجه به اینکه نیاز به تعریف چندین انبار (حد اکثر 100 انبار) می باشد، لازم است مشخص باشد از هر کالا چه تعداد در کدام انبار است. 
برای خروج کالاها از انبار نیاز به جدولی با عنوان مرکز هزینه هست که مشخص شود این کالا برای چه موردی از انبار خارج شده است. این جدول مرکز هزینه باید قابل ویرایش توسط نقشهای ادمین و کاربر ارشد و انباردار ارشد باشد و هنگام خروج کالا لیست آن نمایش داده شود تا کاربر یکی از آنها را انتخاب نماید و در جایی ثبت کند. خودت بهترین و ساده ترین راهکار این قسمت رو به من بگو
4.	برای تعریف سطوح کاربران نیاز به جدول دیگری داریم. باید به این نکات زیر دقت نمود:
•	سطح ادمین که تمام دسترسی هایی که در آینده تعریف می شود را دارد، ضمن اینکه امکان حذف کاربران ، ایجاد کاربران با هر سطحی را دارا خواهد بود. امکان حذف و اضافه کالاها و ... را خواهد داشت
•	سطح کاربر ارشد که او هم دسترسی های زیادی دارد. اما امکان حذف کاربران را ندارد(فقط می تواند آنها را غیرفعال نمیاد). در هنگام نمایش لیست کاربران، او نباید سطوح کاربری ادمین و کاربران ارشد را ببیند. امکان تعریف کاربر جدید با سطحی به جز ادمین و کاربر ارشد را دارد. امکان حذف و اضافه کالاها و ... را خواهد داشت
•	سطح کاربری انباردار ارشد که می تواند لیست کاربران شامل سطح انبارداران را ببیند. به این کاربران، کاربری را اضافه یا ویرایش یا غیرفعال نماید و مشخص کند هر انباردار امکان اضافه یا کم کردن موجودی کدام انبار را دارد. 
•	سطح انباردار. انباردار باید بتواند کالاهای انبار (های) زیر مجموعه خود را اضافه یا کم کند. دقت کنید که یک انباردار ممکن است نیاز به دسترسی به چند انبار را داشته باشد به عبارت دیگر ممکن است چند انبار زیر نظر یک انبار دار باشند. پس باید بتوان مشخص نمود که کاربر انباردار به کدام انبارها دسترسی برای تغییر داشته باشد. ضمنا باید مشخص نمود یک انباردار امکان مشاهده موجودی کدام انبارها را دارد یعنی به غیر از انبارهای زیر نظر خودش، ممکن است نیاز باشد، موجودی انبارهای دیگری را ببیند. اما واضح است که نباید امکان هیچگونه تغییری در انبارهای خارج از زیرمجموعه خود داشته باشد 
5.	سطح کاربری ناظر که تنها می تواند انبارها و اطلاعات کالاهای موجود رو مشاهده کند و ببیند که در هر انبار چه تعداد از کالا وجود دارد یا ببیند که از هر برند چه تعداد از کالا وجود دارد. این سطح اجازه ی هیچ تغییری را نخواهد داشت. 
6.	باز هم تأکید می کنم که کاربر ادمین به تمام امکانات برنامه باید دسترسی داشته باشد. کاربر ارشد هم به تمام امکانات به جز امکان تعریف کاربر با جدید با سطوح ادمین و کاربر ارشد را داشته باشد. همچنین امکان مشاهده لیست کاربران به جز سطوح ادمین و کاربر ارشد داشته باشد.
7.	لازم است هر تغییری (حذف، اضافه،ویرایش کالاها یا کاربران یا ...) در اطلاعات ، به صورت تاریخچه تغییرات در دیتابیس ثبت شود. این تاریخچه باید شامل زمان تغییر، شخص تغییر دهنده و موردی که تغییر داده به صورت مشخص و شرحی که دقیقا مشخص کند کاربر چه کاری انجام داده است، باشد
8.	جدول کاربران که شامل نام ، نام خانوداگی ، کد پرسنلی ، شماره همراه، ایمیل (اختیاری)، رمز (هش شده)، فعال بودن (یک متغیر Boolean) ، تاریخ انقضای فعال بودن (در صورتیکه سطح کاربر ادمین یا کاربر ارشد نباشد، بعد از این تاریخ باید غیر فعال شود.) و مواردی که خودت صلاح میدونی، باشد
9. نقش ادمین می تواند تمام کاربران را ببیند و هر نوع تغییر یا حذف یا اضافه کردن را انجام دهد
نقش ادمین میتواند تمام انبارهای رو ببیند و بدون نیاز به تعریف دسترسی او برای هر انبار، به آنها و موجودی آنها دسترسی داشته باشد. او میتواند تمام موارد دیگر مانند کالاها، برندها و انبارها و دسترسی ها و موجودی ها و ... را ببیند و در آنها تغییر ایجاد نماید.
10. نقش کاربر ارشد می تواند تمام نقشهای دیگر به جز ادمین و کاربران ارشد دیگر را ببیند و می تواند کاربرانی با نقشهای پایین تر از ادمین و کاربر ارشد تعریف کند.(فقط ادمین میتواند کاربرانی با نقش کاربر ارشد تعریف نماید.). او میتواند در کاربرانی که می بیند تغییراتی ایجاد نماید. اما نمیتواند هیچ کاربری را حذف کند. فقط میتواند آنها را غیرفعال یا فعال نماید
او میتواند تمام انبارها رو ببیند و بدون نیاز به تعریف دسترسی او برای هر انبار، به آنها و موجودی آنها دسترسی داشته باشد. او میتواند تمام موارد دیگر مانند کالاها، برندها و انبارها و دسترسی ها و موجودی ها و ... را ببیند و در آنها تغییر ایجاد نماید.
11. نقش انباردار ارشد می تواند فقط کاربرانی با نقش انباردار را ببیند  (تأکید می کنم فقط نقش انباردار رو میتونه ببینه و دیگران رو نمیتونه) و در آنها تغییر ایجاد نماید. او میتواند کاربر جدیدی با نقش انباردار تعریف نماید اما نمیتواند کاربری را حذف کند. فقط میتواند آنها را غیرفعال یا فعال نماید
او میتواند تمام انبارها رو ببیند و بدون نیاز به تعریف دسترسی او برای هر انبار، به آنها و موجودی آنها دسترسی داشته باشد. او میتواند تمام مواردی مانند کالاها، برندها و انبارها و دسترسی ها و موجودی ها و ... را ببیند و در آنها تغییر ایجاد نماید و یا کالای جدیدی را اضافه نماید.
12. نقش انباردار نمی تواند لیست کاربران،برندها و انبارها را ببیند. او می تواند لیست کالاهای انبارهایی را که دسترسی «ویرایش» آنها به او داده شده است را ببیند و فقط در موجودی آنها تغییر ایجاد کند. او میتواند لیست کالاهای موجود در دیگر انبارها را فقط مشاهده کند. اما نمی تواند در آنها تغییر ایجاد نماید. 
13. هرگونه تغییراتی باید در دیتابیس ثبت شود. که البته جدول و کنترلر آن را هم برایت پیوست میکنم. تو باید آنرا بررسی کنی و کاری کنی که به درستی اجرا شود.

از چتهای قبلی تو این پروژه رو پیش بردی اما به دلیل وجود محدودیت تو مجبور شدم دوباره چت جدیدی رو باز کنم
📋 اطلاعات ضروری برای چت جدید
🏗️ ساختار پروژه:
API Project: Inventory_Api (کامل)
Inventory_Api/
├── Controllers/
│   ├── AuthController.cs
│   ├── UsersController.cs
│   ├── ProductsController.cs
│   ├── WarehousesController.cs
│   ├── CostCentersController.cs
│   ├── InventoryController.cs
│   ├── AuditController.cs
│   ├── ReportsController.cs
│   ├── ProfileController.cs
│   ├── BrandsController.cs
│   ├── ProductBrandsController.cs
│   ├── WarehouseAccessController.cs
│   ├── StockOperationsController.cs
│   └── TestController.cs
├── Models/
│   ├── Entities/
│   │   ├── User.cs
│   │   ├── Role.cs
│   │   ├── Product.cs
│   │   ├── Brand.cs
│   │   ├── ProductBrand.cs
│   │   ├── Warehouse.cs
│   │   ├── Inventory.cs
│   │   ├── CostCenter.cs
│   │   ├── WarehouseAccess.cs
│   │   ├── AuditLog.cs
│   │   └── StockOperation.cs
│   ├── DTOs/
│   │   ├── UserDto.cs
│   │   ├── ProductDto.cs
│   │   ├── WarehouseDto.cs
│   │   ├── CostCenterDto.cs
│   │   ├── InventoryDto.cs
│   │   ├── AuditLogDto.cs
│   │   ├── ReportDto.cs
│   │   ├── LoginDto.cs
│   │   ├── ProfileDto.cs
│   │   ├── BrandDto.cs
│   │   ├── ProductBrandDto.cs
│   │   ├── WarehouseAccessDto.cs
│   │   └── StockOperationDto.cs
│   └── ViewModels/
├── Data/
│   ├── ApplicationDbContext.cs
│   └── DbInitializer.cs
├── Services/
│   ├── PasswordHasherService.cs
│   ├── JwtService.cs
│   └── AuditService.cs
├── Helpers/
│   ├── Roles.cs
│   └── AuthorizeRoleAttribute.cs
├── Middlewares/
│   └── UserExpiryMiddleware.cs
├── Interfaces/
├── Repositories/
├── Migrations/
├── Program.cs
├── Startup.cs
├── appsettings.json
└── Inventory_Api.csproj

ار پروژه:
API Project: Inventory_Api (کامل)
Web Project: Inventory_Web (در حال توسعه)
اطلاعات لازم برای ادامه کار در چت جدید
وضعیت فعلی پروژه
1. فایل کنترلر (StockOperationsController.cs)
csharp
// محتوای کامل فایل StockOperationsController.cs از چت قبلی
// این فایل شامل تمام متدها، مدل‌ها و منطق دسترسی‌ها می‌باشد
2. ویوهای موجود
ویو Receive.cshtml (ورود کالا)
html
@model Inventory_Web.Controllers.ReceiveStockViewModel
@{
    ViewData["Title"] = "ورود کالا به انبار";
    Layout = "~/Views/Shared/_Layout.cshtml";
    
    var products = ViewBag.Products as List<Inventory_Web.Controllers.StockProductInfo> ?? new List<Inventory_Web.Controllers.StockProductInfo>();
    var warehouses = ViewBag.Warehouses as List<Inventory_Web.Controllers.StockWarehouseInfo> ?? new List<Inventory_Web.Controllers.StockWarehouseInfo>();
}

<!-- محتوای کامل ویو Receive.cshtml با قابلیت جستجوی Select2 -->
ویو Issue.cshtml (خروج کالا)
html
@model Inventory_Web.Controllers.IssueStockViewModel
@{
    ViewData["Title"] = "خروج کالا از انبار";
    Layout = "~/Views/Shared/_Layout.cshtml";
    
    var products = ViewBag.Products as List<Inventory_Web.Controllers.StockProductInfo> ?? new List<Inventory_Web.Controllers.StockProductInfo>();
    var warehouses = ViewBag.Warehouses as List<Inventory_Web.Controllers.StockWarehouseInfo> ?? new List<Inventory_Web.Controllers.StockWarehouseInfo>();
    var costCenters = ViewBag.CostCenters as List<Inventory_Web.Controllers.CostCenterDto> ?? new List<Inventory_Web.Controllers.CostCenterDto>();
}

<!-- محتوای کامل ویو Issue.cshtml با قابلیت جستجوی Select2 -->
3. تغییرات اخیر اعمال شده ✅
اضافه شدن Select2 برای جستجوی کالاها در هر دو صفحه ورود و خروج

رفع خطای toLowerCase is not a function در منطق جستجو

افزودن قابلیت جستجو بر اساس نام و کد کالا در dropdownها

بهبود UX با نمایش همزمان نام و کد کالا

4. مدل‌های مورد استفاده
csharp
// تمام مدل‌های DTO و ViewModel که در کنترلر تعریف شده‌اند:
- StockOperationDto
- ReceiveStockViewModel  
- IssueStockViewModel
- StockProductInfo
- StockWarehouseInfo
- CostCenterDto
- WarehouseAccessInfo
- و سایر مدل‌های کمکی
5. سرویس‌ها و وابستگی‌ها
csharp
private readonly IApiService _apiService;
// سرویس API برای ارتباط با backend
6. نقش‌های کاربری و سطوح دسترسی
csharp
[Authorize(Roles = "Admin,SeniorUser,SeniorStorekeeper,Storekeeper")]
// سیستم مدیریت دسترسی بر اساس نقش و دسترسی‌های انبار
7. endpointهای API مورد استفاده
text
- GET api/StockOperations
- POST api/StockOperations/receive
- POST api/StockOperations/issue
- GET api/Products
- GET api/Warehouses
- GET api/WarehouseAccess/user/{userId}
- GET api/CostCenters
- GET api/Brands
- GET api/ProductBrands/product/{productId}
- GET api/Inventory/warehouses-with-stock/{productId}
8. کتابخانه‌های front-end استفاده شده
html
- jQuery 3.6.0
- Select2 4.0.13 (با پشتیبانی از زبان فارسی)
- Bootstrap
- Font Awesome
وضعیت فعلی عملکردها
عملکردهای کامل شده ✅
صفحه تاریخچه عملیات (Index) - با قابلیت جستجو

صفحه ورود کالا (Receive) - با Select2 و مدیریت برندها

صفحه خروج کالا (Issue) - با Select2 و مدیریت انبارهای دارای موجودی

مدیریت دسترسی‌ها - بر اساس نقش کاربر و دسترسی‌های انبار

اعتبارسنجی‌های سمت کلاینت و سرور

نکات فنی مهم برای ادامه
ساختار پروژه: ASP.NET Core MVC با معماری سرویس-کنترلر

احراز هویت:基于 JWT Token (با بررسی از sessionStorage/localStorage/cookies)

مدیریت حالت: استفاده از TempData برای پیام‌ها

برنامه‌نویسی ناهمگام:全面使用 async/await

مدیریت خطا: try-catch blocks با ثبت خطا در console

در چت جدید این اطلاعات را ارائه دهید:
text
"ما در حال توسعه سیستم انبارداری هستیم. اطلاعات فعلی:

1. کنترلر StockOperations با تمام متدهای ورود/خروج کالا
2. ویوهای Receive و Issue با قابلیت جستجوی Select2 
3. مدیریت دسترسی بر اساس نقش کاربر
4. مدل‌های کامل DTO و ViewModel
5. endpointهای API مورد استفاده

 وضعیت کنترلرهای🎯 وضعیت کنترلرهای Web:
✅ تکمیل شده:
AuthController.cs - لاگین/لاگاوت با JWT + Session

HomeController.cs - داشبورد اصلی

UsersController.cs - مدیریت کاربران (CRUD کامل)

ProductsController.cs - مدیریت کالاها (CRUD کامل)

WarehousesController.cs - مدیریت انبارها (CRUD کامل)

BrandsController.cs - مدیریت برندها (CRUD کامل)

CostCentersController.cs - مدیریت مراکز هزینه (CRUD کامل)

WarehouseAccessController.cs - مدیریت دسترسی انبارداران

StockOperationsController.cs - عملیات ورود/خروج کالا

InventoryController.cs - مشاهده موجودی انبارها

اتصال کالاها و برندها

⏳ در حال توسعه:

ReportsController.cs - گزارش‌گیری


اطلاعات ضروری برای چت جدید
🏗️ ساختار کامل پروژه
text
Inventory_System/
├── 📁 Inventory_Api/ (پروژه API)
├── 📁 Inventory_Web/ (پروژه Web)
└── 📁 Database/ (فایل‌های دیتابیس)
🔧 مشخصات فنی پروژه
نسخه .NET: ASP.NET Core 5.0

محیط توسعه: Visual Studio 2019 - Windows 10

الگوی معماری: MVC + Web API

پایگاه داده: Entity Framework Core + SQL Server

احراز هویت: JWT + Cookie Authentication

فرانت‌اند: Bootstrap 5 + RTL

ویژگی‌های امنیتی:
✅ فیلتر دسترسی بر اساس نقش

✅ کنترل دسترسی انبارداران به انبارهای خاص

✅ ثبت تاریخچه تغییرات (Audit)

✅ مدیریت session و توکن

-------------------------------------

قبل از شروع گام بعدی چند تا نکته ی خیلی مهم است که باید بهت بگم :

1. در قسمت احراز هویت در web خیلی من رو اذیت کردی و وقت من رو تلف کردی. 
الان بهترین حالت احراز هویت رو داریم و پروژه ی web تا اینجا به خوبی کار کرده
پس اصلا تغییری در قسمت احراز هویت انجام نده. میفهمی یا میخوای مثل چتهای قبلی احمقانه رفتار کنی؟؟؟؟؟؟؟؟
2.قبل از شروع هر گام در صورتیکه محتوای فایلهای موجود نیاز داشتی ، بگو تا برات بذارم با این کار تو باید اصلا خطا نکنی و دیگه وقت من رو تلف نکنی
3. تأکید میکنم : 
بدون اینکه به چیزهایی که تا الان درست کرده ای گند بزنی
به صورت گام به گام و با دقت کامل، برو به گام بعدی

خوب به من گوش بده : تا وقتی بهت نگفتم گام بعدی رو شروع نکن. حتی یک خط کد هم ننویس
فقط بگو گام بعدی چیه؟(میخوام مطمئن بشم که فهمیدی) و برای شروع به چه فایلهایی از پروژه نیاز داری

آیا کاملا فهمیدی چی گفتم؟