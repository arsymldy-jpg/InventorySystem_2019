@model Inventory_Web.Controllers.UserAccessManagementViewModel
@{
    ViewData["Title"] = "مدیریت دسترسی انباردار";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="card">
    <div class="card-header">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h3 class="card-title mb-1">مدیریت دسترسی انباردار</h3>
                <p class="text-muted mb-0">
                    <i class="fas fa-user me-1"></i>@Model.UserName -
                    <i class="fas fa-id-card me-1"></i>کد: @Model.PersonnelCode
                </p>
            </div>
            <a href="@Url.Action("Index")" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-right me-1"></i> بازگشت به لیست
            </a>
        </div>
    </div>

    <div class="card-body">
        <!-- پیام‌های سیستم -->
        @if (TempData["Error"] != null)
        {
            <div class="alert alert-danger mb-3">
                <i class="fas fa-exclamation-triangle me-2"></i>@TempData["Error"]
            </div>
        }

        @if (TempData["Success"] != null)
        {
            <div class="alert alert-success mb-3">
                <i class="fas fa-check-circle me-2"></i>@TempData["Success"]
            </div>
        }

        <!-- فرم افزودن دسترسی جدید -->
        <div class="card border-primary mb-4">
            <div class="card-header bg-primary text-white py-2">
                <h6 class="mb-0">
                    <i class="fas fa-plus-circle me-2"></i>افزودن دسترسی جدید
                </h6>
            </div>
            <div class="card-body p-3">
                <form asp-action="Create" method="post" class="row g-3 align-items-end">
                    <input type="hidden" name="UserId" value="@Model.UserId" />

                    <div class="col-md-5">
                        <label class="form-label fw-bold">انبار</label>
                        <select name="WarehouseId" class="form-select" required>
                            <option value="">-- انتخاب انبار --</option>
                            @foreach (var warehouse in Model.AllWarehouses)
                            {
                                <option value="@warehouse.Id">@warehouse.Name</option>
                            }
                        </select>
                    </div>

                    <div class="col-md-4">
                        <div class="d-flex gap-4">
                            <div class="form-check form-switch">
                                <input name="CanView" class="form-check-input" type="checkbox" id="canView" checked>
                                <label class="form-check-label fw-bold" for="canView">مشاهده</label>
                            </div>
                            <div class="form-check form-switch">
                                <input name="CanEdit" class="form-check-input" type="checkbox" id="canEdit">
                                <label class="form-check-label fw-bold" for="canEdit">ویرایش</label>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-3">
                        <button type="submit" class="btn btn-success w-100">
                            <i class="fas fa-plus me-2"></i>افزودن
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- لیست دسترسی‌های فعلی -->
        <div class="card">
            <div class="card-header bg-light py-2">
                <h6 class="mb-0">
                    <i class="fas fa-list me-2"></i>دسترسی‌های تعریف شده
                    <span class="badge bg-primary ms-2">@Model.CurrentAccess.Count</span>
                </h6>
            </div>
            <div class="card-body p-0">
                @if (Model.CurrentAccess.Count == 0)
                {
                    <div class="text-center py-5 text-muted">
                        <i class="fas fa-warehouse fa-3x mb-3 opacity-50"></i>
                        <h5 class="text-muted">هنوز دسترسی‌ای تعریف نشده</h5>
                        <p class="mb-0">از فرم بالا برای افزودن اولین دسترسی استفاده کنید.</p>
                    </div>
                }
                else
                {
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th width="45%">انبار</th>
                                    <th width="20%" class="text-center">مشاهده</th>
                                    <th width="20%" class="text-center">ویرایش</th>
                                    <th width="15%" class="text-center">عملیات</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var access in Model.CurrentAccess)
                                {
                                    <tr>
                                        <td>
                                            <i class="fas fa-warehouse text-primary me-2"></i>
                                            <span class="fw-bold">@access.WarehouseName</span>
                                        </td>
                                        <td class="text-center">
                                            <span class="badge bg-@(access.CanView ? "success" : "secondary")">
                                                @(access.CanView ? "✔ فعال" : "✖ غیرفعال")
                                            </span>
                                        </td>
                                        <td class="text-center">
                                            <span class="badge bg-@(access.CanEdit ? "success" : "secondary")">
                                                @(access.CanEdit ? "✔ فعال" : "✖ غیرفعال")
                                            </span>
                                        </td>
                                        <td class="text-center">
                                            <form asp-action="Delete" method="post"
                                                  onsubmit="return confirm('آیا از حذف دسترسی به انبار «@access.WarehouseName» اطمینان دارید؟');">
                                                <input type="hidden" name="id" value="@access.Id" />
                                                <input type="hidden" name="userId" value="@Model.UserId" />
                                                @Html.AntiForgeryToken()
                                                <button type="submit" class="btn btn-sm btn-outline-danger" title="حذف">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </form>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
            </div>
        </div>
    </div>
</div>